<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Decision Engine - æ™ºèƒ½åŸå¸‚å†³ç­–ç³»ç»Ÿ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F5F5F7;
            color: #232325;
            font-size: 1.07rem;
            line-height: 1.8;
            letter-spacing: 0.01em;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #d6d3d1; border-radius: 3px; transition: background 0.3s;}
        ::-webkit-scrollbar-thumb:hover { background: #a8a29e; }

        /* === ä¾§è¾¹æ æ˜¾ç¤º/éšè—åŠåŠ¨ç”» === */
        .sidebar {
            transition: transform 0.35s cubic-bezier(0.4,0,0.2,1), box-shadow 0.25s;
            transform: translateX(0);
            will-change: transform;
            z-index: 40;
        }
        .sidebar-hidden {
            transform: translateX(-110%);
            box-shadow: none !important;
        }
        .toggle-sidebar-button, button.md\:hidden {
            font-size: 22px !important;
            padding: 1.05rem !important;
            background-color: #007AFF;
            color: #fff;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.3s, box-shadow 0.3s, transform 0.2s;
            box-shadow: 0 2px 8px rgba(0,122,255,0.08);
            outline: none;
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 50;
        }
        .toggle-sidebar-button:hover, button.md\:hidden:hover {
            background-color: #005BB5;
            box-shadow: 0 4px 18px rgba(0,90,181,0.13);
            transform: scale(1.08) rotate(-3deg);
        }
        .toggle-sidebar-button:focus, button.md\:hidden:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(0,90,181,0.23);
            background-color: #003e7e;
        }

        /* === å›¾è¡¨å®¹å™¨å’Œå¡ç‰‡å¸ƒå±€ä¼˜åŒ– === */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            aspect-ratio: 1 / 1;
            min-height: 240px;
            max-height: 460px;
            min-width: 0;
            box-sizing: border-box;
            overflow: hidden;
            transition: height 0.33s cubic-bezier(0.23, 1, 0.32, 1), box-shadow 0.45s cubic-bezier(0.4,0,0.2,1);
            display: flex;
            align-items: center;
            justify-content: center;
            will-change: height, box-shadow;
        }
        #radarChart {
            width: 100%;
            height: 100%;
        }
        .card, .bg-white.p-5.rounded-2xl, .bg-white.p-6.rounded-2xl, .bg-amber-50\/50.p-6.rounded-2xl {
            margin: 1rem 0;
            padding: 1rem;
            width: 100%;
            box-sizing: border-box;
            border-radius: 1.25rem;
            box-shadow: 0 4px 16px rgba(0,0,0,0.10);
            transition: box-shadow 0.38s cubic-bezier(0.4,0,0.2,1), transform 0.38s cubic-bezier(0.19, 1, 0.22, 1), background-color 0.23s, border-color 0.22s;
            will-change: transform, box-shadow, background-color, border-color;
            background-clip: padding-box;
        }
        .card:hover, .bg-white.p-5.rounded-2xl:hover, .bg-white.p-6.rounded-2xl:hover, .bg-amber-50\/50.p-6.rounded-2xl:hover {
            transform: translateY(-12px) scale(1.045);
            box-shadow: 0 8px 28px rgba(0,122,255,0.09), 0 4px 16px rgba(0,0,0,0.11);
            background-color: #f8fafc;
            border-color: #B3D5FF;
        }

        /* === æŒ‰é’®ä¸è¾“å…¥æ¡†çš„äº¤äº’æ•ˆæœ === */
        button {
            background-color: #007AFF;
            color: #fff;
            border-radius: 9999px;
            padding: 0.85rem 1.25rem;
            font-size: 1.08rem;
            box-sizing: border-box;
            border: 2px solid #007AFF;
            transition: background-color 0.21s cubic-bezier(0.4,0,0.2,1), color 0.19s, transform 0.19s cubic-bezier(0.19, 1, 0.22, 1), box-shadow 0.23s, border-color 0.18s;
            outline: none;
            touch-action: manipulation;
            will-change: transform, background-color, box-shadow, border-color;
            box-shadow: 0 4px 16px rgba(0,0,0,0.10);
        }
        button:hover, button:active {
            background-color: #005BB5;
            transform: translateY(-3px) scale(1.09);
            box-shadow: 0 8px 22px rgba(0,90,181,0.16), 0 4px 16px rgba(0,122,255,0.14);
            border-color: #005BB5;
            color: #fff;
        }
        button:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow: 0 0 0 7px rgba(0,122,255,0.22), 0 4px 16px rgba(0,0,0,0.10);
            background-color: #003e7e;
        }

        /* å¼ºè°ƒè‰²æŒ‰é’®ï¼ˆäº®é»„è‰²ï¼Œä¸»è‰²è°ƒå˜æ›´ä¸ºæ·±ç°è‰²/è“è‰²æ—¶ï¼ŒaccentæŒ‰é’®é£æ ¼ä¹Ÿé€‚åº¦è°ƒæ•´ï¼‰ */
        .btn-accent {
            background-color: #1D1D1F;
            color: #fff;
            border-color: #1D1D1F;
            box-shadow: 0 2px 8px rgba(29,29,31,0.08);
            font-weight: 600;
            transition: background 0.22s, background-color 0.22s, color 0.22s, box-shadow 0.16s, transform 0.18s cubic-bezier(0.4,0,0.2,1), border-color 0.22s;
            will-change: transform, background, box-shadow, border-color;
        }
        .btn-accent:hover, .btn-accent:active {
            background: #007AFF;
            color: #fff;
            box-shadow: 0 8px 22px rgba(0,122,255,0.13), 0 2px 8px rgba(0,0,0,0.10);
            transform: translateY(-2px) scale(1.10);
            border-color: #005BB5;
        }
        .btn-accent:focus {
            outline: none;
            border-color: #1D1D1F;
            box-shadow: 0 0 0 5px rgba(0,90,181,0.23);
        }

        input[type="number"], input[type="text"], input[type="email"], textarea, select {
            padding: 0.8rem 1.1rem;
            border: 1.5px solid #007AFF;
            border-radius: 0.5rem;
            transition: border-color 0.21s cubic-bezier(0.4,0,0.2,1), box-shadow 0.22s, background-color 0.18s;
            box-sizing: border-box;
            font-size: 1.05rem;
            touch-action: manipulation;
            background-color: #fff;
            color: #232325;
            line-height: 1.7;
        }
        input[type="number"]:focus, input[type="text"]:focus, input[type="email"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow: 0 0 0 5px rgba(0,122,255,0.19), 0 2px 10px rgba(0,122,255,0.09);
            background-color: #f5faff;
        }
        input[type="number"]:hover, input[type="text"]:hover, input[type="email"]:hover, textarea:hover, select:hover {
            border-color: #005BB5;
            background-color: #f8fafc;
        }

        /* === æ»šåŠ¨å’Œå¡ç‰‡è¿‡æ¸¡åŠ¨ç”» === */
        .list-move {
            transition: transform 0.8s cubic-bezier(0.19, 1, 0.22, 1), box-shadow 0.35s, background-color 0.33s;
            z-index: 10;
        }
        .list-enter-active,
        .list-leave-active {
            transition: all 0.58s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .list-enter-from,
        .list-leave-to {
            opacity: 0;
            transform: scale(0.92) translateY(14px);
        }
        .list-leave-active {
            position: absolute;
            width: 100%;
        }

        /* === Utility === */
        .tabular-nums { font-variant-numeric: tabular-nums; }

        /* ========= æ–‡æœ¬æ’ç‰ˆä¼˜åŒ– ========= */
        h1, h2, h3, h4, h5, h6 {
            margin-top: 2.2rem;
            margin-bottom: 1.1rem;
            line-height: 1.22;
            font-weight: 700;
            letter-spacing: 0.01em;
            word-break: break-word;
            color: #1D1D1F;
        }
        h1 { font-size: 2.8rem; margin-top: 3rem; margin-bottom: 2rem; color: #1D1D1F; }
        h2 { font-size: 2.2rem; margin-top: 2.4rem; margin-bottom: 1.5rem; color: #1D1D1F; }
        h3 { font-size: 1.7rem; margin-top: 2rem; margin-bottom: 1.2rem; color: #1D1D1F; }
        h4 { font-size: 1.25rem; margin-top: 1.5rem; margin-bottom: 1rem; color: #1D1D1F; }
        h5, h6 { font-size: 1.1rem; margin-top: 1.1rem; margin-bottom: 0.7rem; color: #1D1D1F; }
        p {
            margin-bottom: 1.4em;
            margin-top: 0;
            line-height: 1.92;
            font-size: 1.13rem;
            text-align: justify;
            word-break: break-word;
            max-width: 60em;
            color: #232325;
            letter-spacing: 0.01em;
        }
        ul, ol { margin-bottom: 1.3em; padding-left: 2em; }
        ul li, ol li { margin-bottom: 0.5em; line-height: 1.7; color: #232325; }
        section, article, .space-y-8 > *+* { margin-top: 2.4rem; }
        .text-4xl { font-size: 2.5rem !important; margin-bottom: 1.5rem; letter-spacing: -0.01em; line-height: 1.18; color: #1D1D1F !important; }
        .text-xl, .font-bold.text-stone-700.text-xl { font-size: 1.32rem !important; margin-bottom: 1.1rem; color: #1D1D1F !important; }
        .text-base { font-size: 1.12rem !important; margin-bottom: 1rem; color: #232325 !important; }
        .mt-4, .mb-4, .mb-6 { margin-top: 1.3rem !important; margin-bottom: 1.5rem !important; }
        /* å“åº”å¼ä¸‹æ–‡æœ¬æ’ç‰ˆ */
        @media (max-width: 1024px) {
            h1 { font-size: 2.1rem !important; margin-top: 2rem !important; margin-bottom: 1.2rem !important; color: #1D1D1F !important;}
            h2 { font-size: 1.55rem !important; margin-top: 1.6rem !important; margin-bottom: 1rem !important; color: #1D1D1F !important;}
            h3 { font-size: 1.22rem !important; margin-top: 1.2rem !important; margin-bottom: 0.8rem !important; color: #1D1D1F !important;}
            h4, h5, h6 { font-size: 1.08rem !important; margin-top: 1rem !important; margin-bottom: 0.6rem !important; color: #1D1D1F !important;}
            p, .text-base { font-size: 1rem !important; margin-bottom: 1em; color: #232325 !important;}
            .text-4xl { font-size: 1.7rem !important; color: #1D1D1F !important;}
            .text-xl, .font-bold.text-stone-700.text-xl { font-size: 1.1rem !important; color: #1D1D1F !important;}
            .mt-4, .mb-4, .mb-6 { margin-top: 0.8rem !important; margin-bottom: 1rem !important; }
        }
        @media (max-width: 768px) {
            h1, h2, h3, h4, h5, h6 {
                font-size: 1.08rem !important;
                margin-top: 1.1rem !important;
                margin-bottom: 0.7rem !important;
                color: #1D1D1F !important;
            }
            h1 { font-size: 1.38rem !important; margin-top: 1.3rem !important; margin-bottom: 0.9rem !important; color: #1D1D1F !important;}
            h2 { font-size: 1.18rem !important; color: #1D1D1F !important;}
            h3 { font-size: 1.08rem !important; color: #1D1D1F !important;}
            h4, h5, h6 { font-size: 1.02rem !important; color: #1D1D1F !important;}
            p, .text-base { font-size: 0.97rem !important; margin-bottom: 0.9em; color: #232325 !important;}
            .text-4xl { font-size: 1.15rem !important; color: #1D1D1F !important;}
            .text-xl, .font-bold.text-stone-700.text-xl { font-size: 1rem !important; color: #1D1D1F !important;}
            .mt-4, .mb-4, .mb-6 { margin-top: 0.6rem !important; margin-bottom: 0.7rem !important; }
        }
        @media (max-width: 480px) {
            h1, h2, h3, h4, h5, h6 {
                font-size: 0.99rem !important;
                margin-top: 0.6rem !important;
                margin-bottom: 0.5rem !important;
                color: #1D1D1F !important;
            }
            h1 { font-size: 1.08rem !important; margin-top: 0.7rem !important; margin-bottom: 0.5rem !important; color: #1D1D1F !important;}
            p, .text-base { font-size: 0.92rem !important; color: #232325 !important;}
            .text-4xl { font-size: 1rem !important; color: #1D1D1F !important;}
        }

        /* === ä¼˜åŒ–å“åº”å¼å¸ƒå±€ï¼Œç¡®ä¿æ‰€æœ‰æ ç›®éƒ½èƒ½è‡ªé€‚åº” === */
        @media (max-width: 1024px) {
            /* ä¾§è¾¹æ å’Œä¸»å†…å®¹åŒºåŸŸ */
            #app, .main-content {
                flex-direction: column !important;
            }

            .sidebar {
                min-width: 0 !important;
                max-width: 100vw !important;
                z-index: 50;
            }

            .toggle-sidebar-button {
                display: block !important;
                font-size: 24px !important;
                min-width: 50px !important;
                min-height: 50px !important;
                padding: 1rem !important;
                background-color: #007AFF;
                border-radius: 50%;
                position: fixed;
                top: 1rem;
                left: 1rem;
                z-index: 50;
                box-shadow: 0 2px 8px rgba(0,122,255,0.08);
            }

            .main-content {
                padding-bottom: 1.5rem !important;
                overflow-y: auto !important;
                flex-direction: column !important;
            }

            .card, .bg-white.p-5.rounded-2xl, .bg-white.p-6.rounded-2xl, .bg-amber-50\/50.p-6.rounded-2xl {
                width: 100% !important;
                margin-bottom: 1rem !important;
                padding: 1rem !important;
                box-sizing: border-box;
            }

            /* ä¼˜åŒ–é›·è¾¾å›¾å®¹å™¨ */
            .chart-container {
                width: 100% !important;
                margin-top: 1.5rem !important;
                aspect-ratio: 1 / 1 !important;
                min-height: 220px !important;
                max-height: 340px !important;
            }

            /* è°ƒæ•´å¡ç‰‡å†…å®¹ */
            .grid.grid-cols-2.gap-4 {
                grid-template-columns: 1fr !important;
                gap: 0.5rem !important;
            }

            .space-y-8 > *+* {
                margin-top: 1.5rem !important;
            }
        }

        /* ä¼˜åŒ– Chart.js å›¾è¡¨çš„æ˜¾ç¤ºï¼Œç¡®ä¿é›·è¾¾å›¾åœ¨ä¸åŒæ•°æ®ä¸‹ä¸ä¼šç•¸å½¢ */
        @media (max-width: 768px) {
            .chart-container {
                width: 100% !important;
                margin-top: 1.5rem !important;
                aspect-ratio: 1 / 1 !important;
                min-height: 200px !important;
                max-height: 280px !important;
            }
        }

        /* è¿›ä¸€æ­¥ä¼˜åŒ–æ‰‹æœºç«¯å°å±æ˜¾ç¤º */
        @media (max-width: 480px) {
            .chart-container {
                min-height: 160px !important;
                max-height: 240px !important;
            }
        }
    </style>
</head>
<body class="min-h-screen overflow-x-hidden">

    <div id="app" class="flex w-full h-full flex-col md:flex-row min-h-0 min-w-0">

        <!-- === SIDEBAR: CONTROLS === -->
        <!-- ä¾§è¾¹æ  Toggle æŒ‰é’®ï¼ˆå°å±å¹•å›ºå®šå·¦ä¸Šè§’ï¼‰ -->
        <button 
            class="toggle-sidebar-button md:hidden" 
            @click="toggleSidebar" 
            v-if="window.innerWidth < 768 && !sidebarVisible"
            aria-label="æ˜¾ç¤ºèœå•"
        >
            â˜°
        </button>
        <aside
            class="sidebar flex-shrink-0 bg-white border-r border-stone-200 flex flex-col h-full z-30 shadow-xl overflow-hidden md:block"
            :class="{
                'w-full': window.innerWidth < 768,
                'md:w-80': window.innerWidth >= 768,
                'sidebar-hidden': !sidebarVisible && window.innerWidth < 768,
                'sidebar-visible': sidebarVisible && window.innerWidth < 768,
                'md:block': true
            }"
            v-show="sidebarVisible || window.innerWidth >= 768"
        >
            <!-- Sidebar close button for iPhone/small screen -->
            <button 
                class="toggle-sidebar-button md:hidden" 
                @click="toggleSidebar" 
                v-if="window.innerWidth < 768 && sidebarVisible"
                aria-label="å…³é—­èœå•"
            >âœ•</button>
            <!-- Header -->
            <div class="p-6 border-b border-stone-100 bg-stone-50">
                <h1 class="text-xl font-bold flex items-center gap-2" style="color:#1D1D1F;">
                    <span class="text-2xl" style="color:#007AFF;">â–</span> 
                    å†³ç­–å¼•æ“ <span class="text-[10px] bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full uppercase tracking-wider border border-blue-200" style="background-color:#E5F0FF;color:#007AFF;border-color:#B3D5FF;">Pro</span>
                </h1>
                <p class="text-xs" style="color:#666;">è°ƒæ•´æƒé‡ï¼Œè®©ç®—æ³•ä¸ºæ‚¨å®šåˆ¶æ—…ç¨‹ã€‚</p>
            </div>

            <div class="flex-1 overflow-y-auto p-6 space-y-8 custom-scrollbar">
                
                <!-- Filter Group -->
                <div class="space-y-4">
                    <h3 class="text-xs font-bold uppercase tracking-widest flex items-center gap-2" style="color:#1D1D1F;">
                        <span>ğŸ”</span> åˆæ­¥ç­›é€‰
                    </h3>
                    
                    <div class="space-y-3">
                        <!-- Region Filter -->
                        <div>
                            <label class="text-xs font-semibold text-stone-500 block mb-1.5 ml-1">åœ°ç†åŒºåŸŸ</label>
                            <div class="relative">
                                <select v-model="filters.region" class="w-full text-sm appearance-none bg-stone-50 border border-stone-200 text-stone-700 py-2 px-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-shadow cursor-pointer">
                                    <option value="all">ğŸŒ å…¨åŸŸå±•ç¤º (All)</option>
                                    <option value="North">â„ï¸ åŒ—æ–¹åœ°åŒº</option>
                                    <option value="South">ğŸŒ´ å—æ–¹åœ°åŒº</option>
                                    <option value="East">ğŸ™ï¸ åä¸œæ²¿æµ·</option>
                                    <option value="West">ğŸ”ï¸ è¥¿éƒ¨å†…é™†</option>
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-stone-500">
                                    <span class="text-xs">â–¼</span>
                                </div>
                            </div>
                        </div>

                        <!-- Type Filter -->
                        <div>
                            <label class="text-xs font-semibold text-stone-500 block mb-1.5 ml-1">åŸå¸‚ç±»å‹</label>
                            <div class="flex flex-wrap gap-2">
                        <button 
                            v-for="type in ['å…¨éƒ¨', 'å†å²', 'ç°ä»£', 'è‡ªç„¶']" 
                            :key="type"
                            @click="filters.type = type"
                            class="text-xs px-3 py-1.5 rounded-full border transition-all duration-200"
                            :class="filters.type === type ? 'bg-[#007AFF] text-white border-[#007AFF] shadow-sm' : 'bg-white text-[#1D1D1F] border-stone-200 hover:border-[#007AFF] hover:text-[#007AFF]'"
                        >
                            {{ type }}
                        </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="h-px bg-stone-100"></div>

                <!-- Weights Group -->
                <div class="space-y-4">
                    <div class="flex justify-between items-end">
                        <h3 class="text-xs font-bold uppercase tracking-widest flex items-center gap-2" style="color:#1D1D1F;">
                            <span>ğŸ›ï¸</span> å†³ç­–æƒé‡
                        </h3>
                        <button @click="resetPreferences" class="text-[10px] font-medium underline decoration-blue-200 hover:decoration-blue-600 underline-offset-2 transition-all" style="color:#007AFF;">é‡ç½®é»˜è®¤</button>
                    </div>
                    
                    <div class="space-y-5">
                        <div v-for="(weight, key) in preferences" :key="key" class="group">
                            <div class="flex justify-between items-center mb-2">
                                <label class="text-sm font-semibold text-stone-700 flex items-center gap-2 cursor-pointer" @click="focusSlider(key)">
                                    <span class="text-base filter grayscale group-hover:grayscale-0 transition-all">{{ getIcon(key) }}</span> 
                                    {{ labelMap[key] }}
                                </label>
                                <span class="text-xs font-mono font-bold bg-blue-50 px-2 py-0.5 rounded border border-blue-100 tabular-nums" style="color:#007AFF;">
                                    {{ weight }}%
                                </span>
                            </div>
                            <input 
                                :id="'slider-'+key"
                                type="range" 
                                v-model.number="preferences[key]" 
                                min="0" max="100" step="5" 
                                class="w-full h-1.5 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-[#007AFF]"
                            >
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer Status -->
            <div class="p-3 bg-stone-50 border-t border-stone-200 text-center">
                <p class="text-[10px] text-stone-400 font-medium">
                    å·²åˆ†æ <span class="text-amber-600 font-bold">{{ filteredCities.length }}</span> / {{ cities.length }} ä¸ªç›®çš„åœ°
                </p>
            </div>
        </aside>

        <!-- === MAIN CONTENT === -->
        <main class="main-content flex-1 flex flex-col md:flex-row overflow-hidden bg-stone-50/30 min-h-0 min-w-0">
            <!-- LIST COLUMN: Rankings -->
            <div class="w-full md:w-5/12 lg:w-4/12 flex flex-col border-r border-stone-200 bg-white/80 backdrop-blur z-10 min-h-0">
                <div class="p-4 border-b border-stone-100 sticky top-0 z-20 bg-white/95">
                    <h2 class="font-bold flex items-center gap-2" style="color:#1D1D1F;">
                        <span>ğŸ†</span> æ™ºèƒ½æ’è¡Œ
                    </h2>
                </div>
                
                <div class="flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar relative min-h-0">
                    <transition-group name="list">
                        <div 
                            v-for="(city, index) in rankedCities" 
                            :key="city.id"
                            @click="selectCity(city)"
                            class="relative p-3 rounded-xl border-2 transition-all cursor-pointer group hover:shadow-md transform transition duration-300 ease-in-out hover:scale-105"
                            :class="selectedCity?.id === city.id 
                                ? 'bg-blue-50 border-[#007AFF] ring-1 ring-blue-100 z-10' 
                                : 'bg-white border-transparent hover:border-[#007AFF]'"
                        >
                            <div class="flex items-center gap-3">
                                <!-- Rank Badge -->
                                <div 
                                    class="w-8 h-8 flex-shrink-0 flex items-center justify-center rounded-lg font-bold text-sm transition-all duration-300 font-mono"
                                    :class="index === 0 
                                        ? 'bg-gradient-to-br from-blue-500 to-blue-700 text-white shadow-lg shadow-blue-200 scale-105' 
                                        : index < 3 ? 'bg-stone-100 text-[#1D1D1F]' : 'text-stone-300'"
                                >
                                    {{ index + 1 }}
                                </div>

                                <div class="flex-1 min-w-0">
                                    <div class="flex justify-between items-center mb-1">
                                        <h3 class="font-bold text-stone-800 truncate">{{ city.name }}</h3>
                                        <div class="flex items-center gap-1">
                                            <span class="text-lg font-black tabular-nums" style="color:#007AFF;">
                                                <animated-number :value="Math.round(city.matchScore)"></animated-number>
                                            </span>
                                            <span class="text-[10px] text-stone-400 font-medium pt-1">åˆ†</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Score Bar -->
                                    <div class="w-full h-1.5 bg-stone-100 rounded-full overflow-hidden flex">
                                        <div 
                                            class="h-full" 
                                            :style="{ width: city.matchScore + '%', background: '#007AFF', opacity: 0.8 }"
                                            class="transition-all duration-700 ease-out rounded-full"
                                        ></div>
                                    </div>
                                    
                                    <div class="mt-1.5 flex gap-2 text-[10px] text-stone-400 font-medium">
                                        <span class="bg-stone-50 px-1.5 py-0.5 rounded border border-stone-100">{{ city.regionName }}</span>
                                        <span class="bg-stone-50 px-1.5 py-0.5 rounded border border-stone-100">{{ city.type }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </transition-group>

                    <!-- Empty State -->
                    <div v-if="filteredCities.length === 0" class="absolute inset-0 flex flex-col items-center justify-center text-stone-400">
                        <span class="text-4xl mb-3 grayscale opacity-50">ğŸ”­</span>
                        <p class="text-sm font-medium">æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„åŸå¸‚</p>
                        <button @click="resetFilters" class="mt-3 text-xs btn-accent px-3 py-1.5 rounded-full transition-colors">
                            æ¸…é™¤ç­›é€‰æ¡ä»¶
                        </button>
                    </div>
                </div>
            </div>

            <!-- DETAIL COLUMN: Analysis -->
            <div class="flex-1 overflow-y-auto bg-stone-50 relative custom-scrollbar min-h-0">
                <div v-if="selectedCity" class="p-6 md:p-10 max-w-4xl mx-auto space-y-8 min-h-full">
                    
                    <!-- Intro Header -->
                    <section class="animate-fade-in">
                        <div class="flex flex-col md:flex-row justify-between items-start gap-4">
                            <div>
                                <h2 class="text-4xl font-black mb-3 tracking-tight" style="color:#1D1D1F;">{{ selectedCity.name }}</h2>
                                <p class="text-base leading-relaxed max-w-2xl font-light" style="color:#444;">
                                    {{ selectedCity.desc }}
                                </p>
                                <div class="mt-4 flex flex-wrap gap-2">
                                    <span v-for="tag in selectedCity.tags" :key="tag" class="px-3 py-1 bg-white border border-stone-200 rounded-full text-xs font-semibold text-[#007AFF] shadow-sm flex items-center gap-1">
                                        <span style="color:#007AFF;">#</span> {{ tag }}
                                    </span>
                                </div>
                            </div>
                            <div class="hidden md:block text-right bg-white p-4 rounded-2xl border border-stone-100 shadow-sm">
                                <div class="text-[10px] font-bold text-stone-400 uppercase tracking-widest mb-1">ç»¼åˆåŒ¹é…æŒ‡æ•°</div>
                                <div class="text-5xl font-black tabular-nums tracking-tighter" style="color:#007AFF;">
                                    <animated-number :value="Math.round(selectedCity.matchScore)"></animated-number>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Analysis Grid -->
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                        
                        <!-- Visualization Card -->
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-200 flex flex-col">
                            <h4 class="text-xs font-bold uppercase tracking-widest mb-6 border-b border-stone-50 pb-2" style="color:#1D1D1F;">å¤šç»´èƒ½åŠ›æ¨¡å‹åˆ†æ</h4>
                            <div class="chart-container flex-1 flex items-center justify-center">
                                <canvas id="radarChart"></canvas>
                            </div>
                        </div>

                        <!-- Metrics & Tools -->
                        <div class="space-y-6 flex flex-col">
                            
                            <!-- Info Cards -->
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-white p-5 rounded-2xl border border-stone-200 shadow-sm transition-transform hover:-translate-y-1">
                                    <div class="text-xs text-stone-400 mb-1 font-medium">æ°”æ¸© & æ°”å€™</div>
                                    <div class="font-bold text-[#1D1D1F] text-xl">{{ selectedCity.temp }}</div>
                                    <div class="text-xs text-stone-500 mt-1">{{ selectedCity.weather }}</div>
                                </div>
                                <div class="bg-white p-5 rounded-2xl border border-stone-200 shadow-sm transition-transform hover:-translate-y-1">
                                    <div class="text-xs text-stone-400 mb-1 font-medium">æ¶ˆè´¹æ°´å¹³</div>
                                    <div class="font-bold text-[#007AFF] text-xl tracking-widest">{{ selectedCity.budget }}</div>
                                    <div class="text-xs text-stone-500 mt-1">åŸºç¡€ç‰©ä»·æŒ‡æ•°</div>
                                </div>
                            </div>

                            <!-- Calculator Tool -->
                            <div class="bg-blue-50/50 p-6 rounded-2xl border border-blue-100 flex-1 flex flex-col justify-center">
                                <div class="flex justify-between items-center mb-5">
                                    <h4 class="font-bold flex items-center gap-2" style="color:#1D1D1F;">
                                        <span>ğŸ§®</span> é¢„ç®—è®¡ç®—å™¨
                                    </h4>
                                    <span class="text-[10px] font-bold bg-white" style="color:#007AFF;border:1px solid #B3D5FF;px-2 py-1 rounded">é¢„ä¼°</span>
                                </div>
                                
                                <div class="mb-6">
                                    <div class="flex justify-between text-sm mb-2">
                                        <span class="font-medium" style="color:#1D1D1F;">è®¡åˆ’æ¸¸ç©å¤©æ•°</span>
                                        <span class="font-bold bg-white px-2 py-0.5 rounded border border-blue-100" style="color:#007AFF;">{{ tripDays }} å¤©</span>
                                    </div>
                                    <input type="range" v-model.number="tripDays" min="1" max="15" class="w-full h-2 bg-blue-200 rounded-lg appearance-none cursor-pointer accent-[#007AFF]">
                                    <div class="flex justify-between mt-1 text-[10px] text-stone-400">
                                        <span>1å¤©</span>
                                        <span>15å¤©</span>
                                    </div>
                                </div>

                                <div class="flex justify-between items-end pt-5 border-t border-blue-200/50">
                                    <span class="text-xs text-stone-500 font-medium">é¢„è®¡æ€»èŠ±è´¹ (äººå‡)</span>
                                    <span class="text-2xl font-black tabular-nums" style="color:#1D1D1F;">
                                        <span class="text-sm font-normal text-stone-400 mr-1">Â¥</span><animated-number :value="estimatedCost"></animated-number>
                                    </span>
                                </div>
                            </div>

                            <!-- Spots List -->
                            <div>
                                <h4 class="text-xs font-bold text-stone-400 uppercase tracking-widest mb-3">å¿…å»æ‰“å¡ç‚¹</h4>
                                <div class="flex flex-wrap gap-2">
                                    <div v-for="spot in selectedCity.spots" :key="spot" class="flex items-center gap-1.5 px-3 py-2 bg-white rounded-lg border border-stone-100 text-xs font-medium text-[#1D1D1F] shadow-sm">
                                        <span style="color:#007AFF;">ğŸ“</span> {{ spot }}
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        const { createApp, ref, reactive, computed, watch, onMounted, nextTick } = Vue;

        // === Component: Animated Number Tweening ===
        const AnimatedNumber = {
            props: {
                value: { type: Number, required: true },
                duration: { type: Number, default: 600 }
            },
            template: '<span>{{ displayValue }}</span>',
            setup(props) {
                const displayValue = ref(props.value);
                
                watch(() => props.value, (newVal, oldVal) => {
                    if (oldVal === undefined) {
                        displayValue.value = newVal;
                        return;
                    }
                    const startValue = displayValue.value;
                    const change = newVal - startValue;
                    let startTimestamp = null;
                    
                    const step = (timestamp) => {
                        if (!startTimestamp) startTimestamp = timestamp;
                        const progress = timestamp - startTimestamp;
                        const percentage = Math.min(progress / props.duration, 1);
                        const ease = 1 - Math.pow(1 - percentage, 4); // Ease Out Quart
                        displayValue.value = Math.round(startValue + (change * ease));
                        
                        if (progress < props.duration) window.requestAnimationFrame(step);
                    };
                    window.requestAnimationFrame(step);
                });

                return { displayValue };
            }
        };

        const app = createApp({
            components: { 'animated-number': AnimatedNumber },
            setup() {
                // --- 1. Data Store: 12 Cities Data (Simulating API Response) ---
                const cities = [
                    { 
                        id: 1, name: 'Chengdu', nameCN: 'æˆéƒ½', region: 'West', regionName: 'è¥¿éƒ¨', type: 'ç°ä»£',
                        temp: '16Â°C', weather: 'æ¹¿æ¶¦/å¤šäº‘', budget: 'Â¥Â¥', baseCost: 400,
                        desc: 'å¤©åºœä¹‹å›½ï¼Œæ…¢ç”Ÿæ´»çš„å…¸èŒƒã€‚åœ¨è¿™é‡Œï¼Œç«é”…æ˜¯ä¿¡ä»°ï¼Œå–èŒ¶æ˜¯æ—¥å¸¸ã€‚é€‚åˆæƒ³è¦å½»åº•æ”¾æ¾èº«å¿ƒçš„æ—…è¡Œè€…ã€‚', 
                        tags: ['ç¾é£Ÿ', 'å¤§ç†ŠçŒ«', 'å®‰é€¸'],
                        spots: ['å¤§ç†ŠçŒ«åŸºåœ°', 'æ˜¥ç†™è·¯', 'å®½çª„å··å­', 'å»ºè®¾è·¯'], 
                        scores: { cost: 85, food: 98, culture: 85, nature: 70, safety: 90 } 
                    },
                    { 
                        id: 2, name: 'Beijing', nameCN: 'åŒ—äº¬', region: 'North', regionName: 'åŒ—æ–¹', type: 'å†å²',
                        temp: '12Â°C', weather: 'å¹²ç‡¥/æ™´æœ—', budget: 'Â¥Â¥Â¥', baseCost: 600,
                        desc: 'ä¸‰åƒå¹´å¤éƒ½ï¼Œç°ä»£ä¸­å›½çš„æ ¸å¿ƒã€‚å®ä¼Ÿçš„çš‡å®¶å»ºç­‘ä¸å……æ»¡çƒŸç«æ°”çš„èƒ¡åŒå…±å­˜ï¼Œæ˜¯æ„Ÿå—ä¸­åæ–‡æ˜åšåº¦çš„é¦–é€‰ã€‚', 
                        tags: ['æ•…å®«', 'èƒ¡åŒ', 'é¦–éƒ½'],
                        spots: ['æ•…å®«åšç‰©é™¢', 'å…«è¾¾å²­é•¿åŸ', 'ç¯çƒå½±åŸ', 'é¢å’Œå›­'], 
                        scores: { cost: 50, food: 88, culture: 98, nature: 60, safety: 95 } 
                    },
                    { 
                        id: 3, name: 'Sanya', nameCN: 'ä¸‰äºš', region: 'South', regionName: 'å—æ–¹', type: 'è‡ªç„¶',
                        temp: '28Â°C', weather: 'çƒ­å¸¦æµ·æ´‹', budget: 'Â¥Â¥Â¥Â¥', baseCost: 800,
                        desc: 'æ‹¥æœ‰ä¸­å›½æœ€è¿·äººçš„çƒ­å¸¦æµ·å²¸çº¿ã€‚æ— è®ºæ˜¯å†²æµªæ½œæ°´è¿˜æ˜¯èººå¹³åº¦å‡ï¼Œè¿™é‡Œéƒ½èƒ½æ»¡è¶³ä½ å¯¹æµ·å²›çš„æ‰€æœ‰å¹»æƒ³ã€‚', 
                        tags: ['æµ·æ»©', 'åº¦å‡', 'æ½œæ°´'],
                        spots: ['äºšé¾™æ¹¾', 'èœˆæ”¯æ´²å²›', 'åæµ·æ‘', 'å…ç¨åŸ'], 
                        scores: { cost: 30, food: 75, culture: 60, nature: 95, safety: 85 } 
                    },
                    { 
                        id: 4, name: 'Lanzhou', nameCN: 'å…°å·', region: 'West', regionName: 'è¥¿éƒ¨', type: 'å†å²',
                        temp: '10Â°C', weather: 'å¹²ç‡¥/å¤§é£', budget: 'Â¥', baseCost: 300,
                        desc: 'é»„æ²³ç©¿åŸè€Œè¿‡çš„è±ªè¿ˆåŸå¸‚ã€‚ä¸€ç¢—ç‰›è‚‰é¢å¼€å¯ä¸€å¤©ï¼Œè¿™é‡Œæ˜¯æ¢ç´¢å¤§è¥¿åŒ—ç¯çº¿çš„æœ€ä½³èµ·ç‚¹ï¼Œæ€§ä»·æ¯”æé«˜ã€‚', 
                        tags: ['ç‰›è‚‰é¢', 'é»„æ²³', 'ä¸­è½¬ç«™'],
                        spots: ['ä¸­å±±æ¡¥', 'ç”˜è‚ƒåšç‰©é¦†', 'ç™½å¡”å±±', 'æ­£å®è·¯å¤œå¸‚'], 
                        scores: { cost: 95, food: 90, culture: 75, nature: 80, safety: 80 } 
                    },
                    { 
                        id: 5, name: 'Shanghai', nameCN: 'ä¸Šæµ·', region: 'East', regionName: 'åä¸œ', type: 'ç°ä»£',
                        temp: '15Â°C', weather: 'æ¹¿æ¶¦', budget: 'Â¥Â¥Â¥Â¥', baseCost: 750,
                        desc: 'é­”éƒ½ï¼Œæè‡´ç¹åä¸æµ·æ´¾é£æƒ…çš„äº¤å“ã€‚å¤–æ»©çš„ä¸‡å›½å»ºç­‘åšè§ˆç¾¤ä¸é™†å®¶å˜´çš„å¤©é™…çº¿éš”æ±Ÿç›¸æœ›ã€‚', 
                        tags: ['å¤–æ»©', 'è¿ªå£«å°¼', 'æ‘©ç™»'],
                        spots: ['å¤–æ»©', 'é™†å®¶å˜´ä¸‰ä»¶å¥—', 'è¿ªå£«å°¼', 'æ­¦åº·è·¯'], 
                        scores: { cost: 40, food: 92, culture: 88, nature: 50, safety: 95 } 
                    },
                    { 
                        id: 6, name: 'Guilin', nameCN: 'æ¡‚æ—', region: 'South', regionName: 'å—æ–¹', type: 'è‡ªç„¶',
                        temp: '20Â°C', weather: 'å¤šé›¨/æ¹¿æ¶¦', budget: 'Â¥Â¥', baseCost: 450,
                        desc: 'æ¡‚æ—å±±æ°´ç”²å¤©ä¸‹ã€‚å–€æ–¯ç‰¹åœ°è²Œçš„å·…å³°ä¹‹ä½œï¼Œä¹˜ä¸€å¶ç«¹ç­æ³›èˆŸæ¼“æ±Ÿï¼Œä»¿ä½›ç½®èº«äºæ°´å¢¨ç”»å·ä¹‹ä¸­ã€‚', 
                        tags: ['å±±æ°´', 'æ¼“æ±Ÿ', 'ç”°å›­'],
                        spots: ['æ¼“æ±Ÿæ¼‚æµ', 'è±¡é¼»å±±', 'é˜³æœ”è¥¿è¡—', 'é¾™è„Šæ¢¯ç”°'], 
                        scores: { cost: 80, food: 80, culture: 70, nature: 98, safety: 85 } 
                    },
                    { 
                        id: 7, name: 'Xian', nameCN: 'è¥¿å®‰', region: 'West', regionName: 'è¥¿éƒ¨', type: 'å†å²',
                        temp: '14Â°C', weather: 'å¹²ç‡¥', budget: 'Â¥Â¥', baseCost: 400,
                        desc: 'åä¸‰æœå¤éƒ½ï¼Œä¸–ç•Œå†å²ååŸã€‚å…µé©¬ä¿‘çš„éœ‡æ’¼ä¸å›æ°‘è¡—çš„çƒŸç«æ°”ï¼Œäº¤ç»‡å‡ºä¸€åº§åšé‡è€Œé²œæ´»çš„åŸå¸‚ã€‚', 
                        tags: ['å…µé©¬ä¿‘', 'ç¢³æ°´ä¹‹éƒ½', 'å¤§å”'],
                        spots: ['å…µé©¬ä¿‘', 'å¤§å”ä¸å¤œåŸ', 'å¤åŸå¢™', 'é™•è¥¿å†å²åšç‰©é¦†'], 
                        scores: { cost: 75, food: 95, culture: 99, nature: 50, safety: 85 } 
                    },
                    { 
                        id: 8, name: 'Chongqing', nameCN: 'é‡åº†', region: 'West', regionName: 'è¥¿éƒ¨', type: 'ç°ä»£',
                        temp: '18Â°C', weather: 'å¤šé›¾/æ¹¿æ¶¦', budget: 'Â¥Â¥', baseCost: 400,
                        desc: '8Dé­”å¹»å±±åŸï¼Œè½»è½¨ç©¿æ¥¼è€Œè¿‡ã€‚è¿™é‡Œåœ°å½¢å¤æ‚ï¼Œå¤œæ™¯ç’€ç’¨ï¼Œæ˜¯èµ›åšæœ‹å…‹é£æ ¼çš„ç°å®å†™ç…§ã€‚', 
                        tags: ['ç«é”…', '8Dé­”å¹»', 'å¤œæ™¯'],
                        spots: ['æ´ªå´–æ´', 'è§£æ”¾ç¢‘', 'æå­åè½»è½¨', 'é•¿æ±Ÿç´¢é“'], 
                        scores: { cost: 80, food: 96, culture: 75, nature: 70, safety: 85 } 
                    },
                    { 
                        id: 9, name: 'Hangzhou', nameCN: 'æ­å·', region: 'East', regionName: 'åä¸œ', type: 'è‡ªç„¶',
                        temp: '16Â°C', weather: 'æ¹¿æ¶¦/å®œäºº', budget: 'Â¥Â¥Â¥', baseCost: 550,
                        desc: 'â€œä¸Šæœ‰å¤©å ‚ï¼Œä¸‹æœ‰è‹æ­â€ã€‚è¥¿æ¹–çš„æ–­æ¡¥æ®‹é›ªï¼Œé¾™äº•çš„èŒ¶é¦™ï¼Œè¿™é‡Œæ˜¯æ±Ÿå—æ¸©å©‰æ°”è´¨çš„æè‡´ä»£è¡¨ã€‚', 
                        tags: ['è¥¿æ¹–', 'æ±Ÿå—', 'èŒ¶æ–‡åŒ–'],
                        spots: ['è¥¿æ¹–', 'çµéšå¯º', 'è¥¿æºªæ¹¿åœ°', 'é¾™äº•æ‘'], 
                        scores: { cost: 60, food: 85, culture: 90, nature: 95, safety: 95 } 
                    },
                    { 
                        id: 10, name: 'Xiamen', nameCN: 'å¦é—¨', region: 'South', regionName: 'å—æ–¹', type: 'è‡ªç„¶',
                        temp: '22Â°C', weather: 'æµ·é£/èˆ’é€‚', budget: 'Â¥Â¥Â¥', baseCost: 500,
                        desc: 'æ–‡è‰ºæ¸…æ–°çš„æµ·ä¸ŠèŠ±å›­ã€‚é¼“æµªå±¿çš„ä¸‡å›½å»ºç­‘ï¼Œç¯å²›è·¯çš„æ¤°é£æµ·éŸµï¼Œé€‚åˆæ¼«æ— ç›®çš„åœ°é—²é€›ã€‚', 
                        tags: ['é¼“æµªå±¿', 'æ–‡è‰º', 'æµ·é²œ'],
                        spots: ['é¼“æµªå±¿', 'å¦é—¨å¤§å­¦', 'ç¯å²›è·¯', 'æ›¾ååµ'], 
                        scores: { cost: 65, food: 88, culture: 75, nature: 92, safety: 90 } 
                    },
                    { 
                        id: 11, name: 'Harbin', nameCN: 'å“ˆå°”æ»¨', region: 'North', regionName: 'åŒ—æ–¹', type: 'è‡ªç„¶',
                        temp: '-5Â°C', weather: 'å¯’å†·/å†°é›ª', budget: 'Â¥Â¥', baseCost: 450,
                        desc: 'â€œä¸œæ–¹è«æ–¯ç§‘â€ã€‚å†°é›ªå¤§ä¸–ç•Œçš„æ¢¦å¹»ï¼Œä¸­å¤®å¤§è¡—çš„ä¿„å¼é£æƒ…ï¼Œæ˜¯å†¬æ—¥é‡Œæœ€æµªæ¼«çš„ç«¥è¯ä¸–ç•Œã€‚', 
                        tags: ['å†°é›ª', 'ä¿„å¼é£æƒ…', 'æ»‘é›ª'],
                        spots: ['å†°é›ªå¤§ä¸–ç•Œ', 'ä¸­å¤®å¤§è¡—', 'åœ£ç´¢è²äºšå¤§æ•™å ‚', 'æ¾èŠ±æ±Ÿ'], 
                        scores: { cost: 75, food: 85, culture: 80, nature: 98, safety: 80 } 
                    },
                    { 
                        id: 12, name: 'Lhasa', nameCN: 'æ‹‰è¨', region: 'West', regionName: 'è¥¿éƒ¨', type: 'å†å²',
                        temp: '8Â°C', weather: 'é«˜åŸ/é˜³å…‰', budget: 'Â¥Â¥Â¥', baseCost: 500,
                        desc: 'æ—¥å…‰åŸï¼Œå¿ƒçµçš„å½’å®¿ã€‚å¸ƒè¾¾æ‹‰å®«çš„é‡‘é¡¶åœ¨é˜³å…‰ä¸‹ç† ç† ç”Ÿè¾‰ï¼Œä¿¡ä»°çš„åŠ›é‡åœ¨è¿™é‡Œè§¦æ‰‹å¯åŠã€‚', 
                        tags: ['ä¿¡ä»°', 'é«˜åŸ', 'å¸ƒè¾¾æ‹‰å®«'],
                        spots: ['å¸ƒè¾¾æ‹‰å®«', 'å¤§æ˜­å¯º', 'å…«å»“è¡—', 'çº³æœ¨é”™'], 
                        scores: { cost: 60, food: 70, culture: 98, nature: 98, safety: 75 } 
                    }
                ];

                const labelMap = {
                    cost: 'æ€§ä»·æ¯”', food: 'ç¾é£ŸæŒ‡æ•°', culture: 'æ–‡åŒ–åº•è•´', nature: 'è‡ªç„¶é£å…‰', safety: 'åŸå¸‚è®¾æ–½'
                };

                // --- 2. State Management ---
                const preferences = reactive({ cost: 50, food: 50, culture: 50, nature: 50, safety: 50 });
                const filters = reactive({ region: 'all', type: 'å…¨éƒ¨' });
                const tripDays = ref(5);
                const selectedCity = ref(null); // Init via Watcher
                let chartInstance = null;
                // å“åº”å¼ä¾§è¾¹æ 
                const sidebarVisible = ref(window.innerWidth >= 768);
                // ç”¨äºå“åº”å¼æ˜¾ç¤ºæŒ‰é’®
                const updateSidebarOnResize = () => {
                    if (window.innerWidth < 768) {
                        sidebarVisible.value = false;
                    } else {
                        sidebarVisible.value = true;
                    }
                };
                const toggleSidebar = () => {
                    sidebarVisible.value = !sidebarVisible.value;
                };

                // --- 3. Computed Logic ---
                // Filter Cities
                const filteredCities = computed(() => {
                    return cities.filter(city => {
                        const matchRegion = filters.region === 'all' || city.region === filters.region;
                        const matchType = filters.type === 'å…¨éƒ¨' || city.type === filters.type;
                        return matchRegion && matchType;
                    });
                });

                // Rank Cities (Weighted Algo)
                const rankedCities = computed(() => {
                    return filteredCities.value.map(city => {
                        let totalScore = 0;
                        let totalWeight = 0;
                        for (const key in preferences) {
                            const weight = preferences[key];
                            const score = city.scores[key];
                            totalScore += score * weight;
                            totalWeight += weight;
                        }
                        const finalScore = totalWeight === 0 ? 0 : (totalScore / totalWeight);
                        
                        return { ...city, name: city.nameCN, matchScore: finalScore };
                    }).sort((a, b) => b.matchScore - a.matchScore);
                });

                // Budget Calc
                const estimatedCost = computed(() => {
                    if (!selectedCity.value) return 0;
                    return selectedCity.value.baseCost * tripDays.value;
                });

        // --- 4. Chart.js Controller ---
        // ç»Ÿä¸€è°ƒæ•´æ‰€æœ‰åŸå¸‚é›·è¾¾å›¾æ˜¾ç¤ºï¼Œç¡®ä¿ä¸€è‡´æ€§
        const updateChart = () => {
            const ctx = document.getElementById('radarChart');
            if (!ctx || !selectedCity.value) return;

            // ä¿è¯æ‰€æœ‰åŸå¸‚çš„è¯„åˆ†é¡ºåºå’Œæ•°é‡ä¸€è‡´
            const dataValues = [
                selectedCity.value.scores.cost,
                selectedCity.value.scores.food,
                selectedCity.value.scores.culture,
                selectedCity.value.scores.nature,
                selectedCity.value.scores.safety
            ];

            // å¹³å‡åŸºå‡†æ•°æ®ï¼šå–æ‰€æœ‰åŸå¸‚å„é¡¹å¹³å‡å€¼ï¼Œç¡®ä¿æ‰€æœ‰åŸå¸‚åŸºå‡†ä¸€è‡´
            const allScores = cities.map(city => city.scores);
            const avg = key => Math.round(allScores.reduce((sum, s) => sum + s[key], 0) / allScores.length);
            const baselineData = [
                avg('cost'),
                avg('food'),
                avg('culture'),
                avg('nature'),
                avg('safety')
            ];

            // åŠ¨ç”»å‚æ•°ï¼Œæ•°æ®å˜åŒ–æ—¶å¹³æ»‘è¿‡æ¸¡
            const chartAnimation = { duration: 900, easing: 'easeOutCubic' };

            if (chartInstance) {
                // åŠ¨æ€æ›´æ–°æ•°æ®ä¸labelï¼Œè§¦å‘åŠ¨ç”»
                chartInstance.data.datasets[0].label = selectedCity.value.name;
                chartInstance.options.animation = chartAnimation;
                chartInstance.data.datasets[0].data = dataValues;
                chartInstance.data.datasets[1].data = baselineData;
                chartInstance.data.datasets[0].tension = 0;
                chartInstance.data.datasets[0].pointRadius = 4;
                chartInstance.data.datasets[0].pointHoverRadius = 6;
                chartInstance.update();
            } else {
                chartInstance = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: ['æ€§ä»·æ¯”', 'ç¾é£Ÿ', 'æ–‡åŒ–', 'è‡ªç„¶', 'è®¾æ–½'],
                        datasets: [{
                            label: selectedCity.value.name,
                            data: dataValues,
                            fill: true,
                            backgroundColor: 'rgba(0, 122, 255, 0.16)',
                            borderColor: '#007AFF',
                            pointBackgroundColor: '#fff',
                            pointBorderColor: '#007AFF',
                            pointHoverBackgroundColor: '#005BB5',
                            pointHoverBorderColor: '#fff',
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            tension: 0
                        }, {
                            label: 'å¹³å‡åŸºå‡†',
                            data: baselineData,
                            fill: true,
                            backgroundColor: 'rgba(29,29,31,0.05)',
                            borderColor: 'rgba(29,29,31,0.13)',
                            pointRadius: 0,
                            tension: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 1,
                        scales: {
                            r: {
                                angleLines: { color: '#f5f5f4' },
                                grid: { color: '#e7e5e4' },
                                pointLabels: { font: { size: 13, family: "'Inter', sans-serif" }, color: '#78716c' },
                                suggestedMin: 0, suggestedMax: 100,
                                ticks: { display: false }
                            }
                        },
                        plugins: {
                            legend: { position: 'bottom', labels: { usePointStyle: true, font: { family: "'Inter'" }, color: '#57534e' } },
                            tooltip: {
                                enabled: true,
                                backgroundColor: '#fff',
                                titleColor: '#007AFF',
                                bodyColor: '#232325',
                                borderColor: '#B3D5FF',
                                borderWidth: 1,
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label;
                                        const value = context.raw;
                                        const datasetLabel = context.dataset.label;
                                        let detail = '';
                                        switch (label) {
                                            case 'æ€§ä»·æ¯”':
                                                detail = 'ï¼ˆèŠ±è´¹ä¸ä½“éªŒçš„å¹³è¡¡ï¼‰';
                                                break;
                                            case 'ç¾é£Ÿ':
                                                detail = 'ï¼ˆå½“åœ°ç¾é£Ÿä¸°å¯Œåº¦ï¼‰';
                                                break;
                                            case 'æ–‡åŒ–':
                                                detail = 'ï¼ˆå†å²ä¸æ–‡åŒ–åº•è•´ï¼‰';
                                                break;
                                            case 'è‡ªç„¶':
                                                detail = 'ï¼ˆè‡ªç„¶æ™¯è§‚å’Œç¯å¢ƒï¼‰';
                                                break;
                                            case 'è®¾æ–½':
                                                detail = 'ï¼ˆå®‰å…¨ä¸åŸºç¡€è®¾æ–½ï¼‰';
                                                break;
                                            default:
                                                detail = '';
                                        }
                                        return `${datasetLabel} - ${label}${detail}: ${value}%`;
                                    }
                                }
                            }
                        },
                        animation: chartAnimation
                    }
                });
            }
        };

                // --- 5. Interactions ---
                const selectCity = (city) => { selectedCity.value = city; };
                const resetPreferences = () => { Object.keys(preferences).forEach(k => preferences[k] = 50); };
                const resetFilters = () => { filters.region = 'all'; filters.type = 'å…¨éƒ¨'; };
                const getIcon = (key) => { return { cost: 'ğŸ’°', food: 'ğŸœ', culture: 'ğŸ›ï¸', nature: 'ğŸŒ²', safety: 'ğŸš¦' }[key]; };
                const focusSlider = (key) => { document.getElementById('slider-'+key)?.focus(); };

                // --- 6. Watchers ---
                watch(() => selectedCity.value, () => nextTick(() => updateChart()));

                // Auto-selection Logic: Ensure a city is always selected if available
                watch(rankedCities, (newVal) => {
                    if (newVal.length > 0) {
                        // Keep current if still in list, otherwise select top
                        if (!selectedCity.value || !newVal.find(c => c.id === selectedCity.value.id)) {
                            selectCity(newVal[0]);
                        }
                    } else {
                        selectedCity.value = null;
                    }
                }, { immediate: true });

                onMounted(() => {
                    window.addEventListener('resize', () => {
                        // å“åº”å¼è°ƒæ•´å›¾è¡¨å¤§å°
                        if (chartInstance) {
                            chartInstance.resize();
                        }
                        updateSidebarOnResize();
                    });
                    updateSidebarOnResize();
                });

                return {
                    cities, filteredCities, rankedCities,
                    labelMap, preferences, filters,
                    selectedCity, tripDays, estimatedCost,
                    selectCity, resetPreferences, resetFilters, getIcon, focusSlider,
                    sidebarVisible, toggleSidebar,
                    window // è®©æ¨¡æ¿å¯ä»¥è®¿é—®window.innerWidth
                };
            }
        });
        
        app.mount('#app');
    </script>
    <style>
    /* ========== Flexboxå¸ƒå±€ä¼˜åŒ– ========== */
    #app {
        display: flex;
        width: 100vw;
        height: 100vh;
        min-height: 100vh;
        min-width: 0;
        flex-direction: row;
        font-family: 'Inter', sans-serif;
    }
    .sidebar {
        min-width: 230px;
        max-width: 350px;
        min-height: 0;
    }
    .main-content {
        display: flex;
        flex: 1 1 0%;
        min-width: 0;
        min-height: 0;
        flex-direction: row;
    }
    /* ç§»åŠ¨ç«¯å…è®¸é¡µé¢æ•´ä½“æ»šåŠ¨ï¼Œé¿å… 100vh é™åˆ¶å¯¼è‡´å†…å®¹è¢«è£åˆ‡ */
    @media (max-width: 900px) {
        body, #app {
            height: auto;
            min-height: 100vh;
            overflow-y: auto;
        }
        .main-content {
            height: auto;
            min-height: 0;
            overflow: visible;
        }
        .sidebar {
            min-height: auto;
        }
    }
    </style>

</body>
</html>
